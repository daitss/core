#!/usr/bin/env ruby
require 'bundler/setup'
require 'ruby-debug'

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')

require "daitss"
require 'daitss/proc/wip/d1_refresh'

include Daitss

archive#.init_seed
        
  # wip
id = ARGV.shift or raise "package id required"

# make the request
package = Package.get(id)
agent = Agent.get('root')
request = Request.new(:type => :d1refresh, :is_authorized => true, :agent => agent, :package => package)

request.save or raise 'oops'
sleep 0.5 until package.wip
wip = package.wip
sleep 0.5 while wip.running?
puts wip.state